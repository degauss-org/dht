<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dht">
<title>Developing a New DeGAUSS Container â€¢ dht</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Developing a New DeGAUSS Container">
<meta property="og:description" content="dht">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dht</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/developing-degauss.html">Developing a New DeGAUSS Container</a>
    <a class="dropdown-item" href="../articles/helper-functions.html">In-Line Helper Functions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/degauss-org/dht/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="developing-degauss_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Developing a New DeGAUSS Container</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/degauss-org/dht/blob/HEAD/vignettes/developing-degauss.Rmd" class="external-link"><code>vignettes/developing-degauss.Rmd</code></a></small>
      <div class="d-none name"><code>developing-degauss.Rmd</code></div>
    </div>

    
    
<p>The following guide is a step-by-step instruction manual for developing a <a href="https://degauss.org" class="external-link">DeGAUSS</a> container using tools available in the <a href="https://degauss.org/dht" class="external-link"><code>dht</code> R package</a>.</p>
<div class="section level3">
<h3 id="creating-all-files-needed">Creating all files needed<a class="anchor" aria-label="anchor" href="#creating-all-files-needed"></a>
</h3>
<p>Within an empty directory, use <code><a href="../reference/use_degauss_container.html">dht::use_degauss_container()</a></code> to create all of the files needed for a DeGAUSS container. Note that the name of this initially empty directory will be used as the name of the geomarker in the documentation, code, and image repository; it is a good idea to only use lower case letters and underscores (e.g., <code>census_block_group</code>) to comply with container naming conventions.</p>
<ul>
<li>Most of the added files will <em>usually</em> not need to be edited:
<ul>
<li>
<code>Makefile</code> (see below for <code>Make</code> targets)</li>
<li>
<code>test/my_address_file_geocoded.csv</code> (test input data file)</li>
<li>
<code>LICENSE.md</code> (GPL license)</li>
<li>
<code>.github/workflows/build-deply.yaml</code> (GitHub Actions continuous integration)</li>
<li>
<code>.dockerignore</code> (edit to include files other than entrypoint.R in the image)</li>
</ul>
</li>
<li>Files that <strong>need</strong> to be edited:
<ul>
<li>
<code>Dockerfile</code> (<code>degauss_description</code> environment variable)</li>
<li>
<code>entrypoint.R</code> (contains R code to be run in the container)</li>
<li>
<code>README.md</code> (software documentation and example instructions)</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="editing-files-to-add-r-code-and-documentation">Editing files to add R code and documentation<a class="anchor" aria-label="anchor" href="#editing-files-to-add-r-code-and-documentation"></a>
</h3>
<div class="section level4">
<h4 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h4>
<p>Add any geomarker information and additional details to <code>README.md</code>. Make sure that the version in the example call matches the version of the latest released container.</p>
<p>Environment variables (<code>degauss_name</code>, <code>degauss_version</code>, and <code>degauss_description</code>) are defined within the <code>Dockerfile</code> so that they will be available to R code running from inside the container. All but <code>degauss_description</code> are automatically defined and this value needs to be edited from</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">ENV</span> degauss_description=<span class="st">"insert short description here that finishes the sentence </span><span class="kw">`</span><span class="ex">This</span> container ...<span class="kw">`</span><span class="st">"</span></span></code></pre></div>
<p>to something specific, like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">ENV</span> degauss_description=<span class="st">"assigns census block group for different vintages of census geographies"</span></span></code></pre></div>
<p>In the future, the environment variable <code>degauss_version</code> can be edited in the <code>Dockerfile</code> and R code in the container can use it for greetings, writing output files, and other operations that depend on the current version (or name or description).</p>
</div>
<div class="section level4">
<h4 id="using-r-code-and-data-files-inside-the-container">Using R code and data files inside the container<a class="anchor" aria-label="anchor" href="#using-r-code-and-data-files-inside-the-container"></a>
</h4>
<p>Edit <code>entrypoint.R</code> by replacing the example R code with R code that completes the specific task to be performed by the container.</p>
<p>When ready to build the container, run <code><a href="https://rstudio.github.io/renv/reference/init.html" class="external-link">renv::init()</a></code> to initiate the <code>renv</code> framework and create <code>renv.lock</code>. Subsequent builds can update <code>renv.lock</code> by using <code><a href="https://rstudio.github.io/renv/reference/snapshot.html" class="external-link">renv::snapshot()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="including-files-inside-the-container">Including files inside the container<a class="anchor" aria-label="anchor" href="#including-files-inside-the-container"></a>
</h3>
<p>By default, the container will copy in <code>entrypoint.R</code> and <code>renv.lock</code> for use at runtime and ignore anything else in the working directory to automatically speed up build times and keep containers smaller in size. If the container requires any other files (e.g., <code>.rds</code> datafiles), edit <code>Dockerfile</code> and <code>.dockerignore</code> so that the files are copied to the container and not ignored by Docker. For example, if we want to use <code>geomarker_data.rds</code>, we would make the following changes in <code>Dockerfile</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a>    <span class="ex">COPY</span> entrypoint.R .</span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="ex">COPY</span> geomarker_data.rds    <span class="co"># copy .rds file from host to container when building</span></span></code></pre></div>
<p>and in <code>.dockerignore</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a>    <span class="co"># ignore everything</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="ex">**</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="co"># except what we need</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>    !<span class="ex">/renv.lock</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>    !<span class="ex">/entrypoint.R</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    !<span class="ex">/geomarker_data.rds</span>      <span class="co"># make sure the .rds file is not ignored</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tests">Tests<a class="anchor" aria-label="anchor" href="#tests"></a>
</h3>
<p>A <code>test</code> directory is added with an example geocoded address file (<code>test/my_address_file_geocoded.csv</code>) and is useful for interactive development and automated testing (see below).</p>
</div>
<div class="section level3">
<h3 id="using-make-for-interactive-development">Using <code>make</code> for interactive development<a class="anchor" aria-label="anchor" href="#using-make-for-interactive-development"></a>
</h3>
<p>The <code>Makefile</code> defines several useful <code>make</code> targets that can be useful when locally developing and testing:</p>
<ul>
<li>
<code>make build</code> will build the current DeGAUSS image and name it</li>
<li>
<code>make test</code> will run the container on the included example geocoded CSV file</li>
<li>
<code>make shell</code> will run a DeGAUSS command, but start an interactive shell inside the container for debugging</li>
<li>
<code>make clean</code> is equivalent to <code>docker system prune -f</code>, which cleans up any stopped containers or dangling image layers</li>
</ul>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Erika Rasnick, Cole Brokamp.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
