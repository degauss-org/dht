<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dht">
<title>Calling DeGAUSS from R • dht</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calling DeGAUSS from R">
<meta property="og:description" content="dht">
<meta property="og:image" content="http://degauss.org/dht/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dht</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calling-degauss-from-R.html">Calling DeGAUSS from R</a>
    <a class="dropdown-item" href="../articles/degauss-metadata-specification.html">DeGAUSS Metadata Specifications</a>
    <a class="dropdown-item" href="../articles/developing-degauss.html">Developing a New DeGAUSS Container</a>
    <a class="dropdown-item" href="../articles/helper-functions.html">Helper Functions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/degauss-org/dht/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calling DeGAUSS from R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/degauss-org/dht/blob/HEAD/vignettes/calling-degauss-from-R.Rmd" class="external-link"><code>vignettes/calling-degauss-from-R.Rmd</code></a></small>
      <div class="d-none name"><code>calling-degauss-from-R.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p><a href="https://degauss.org" class="external-link">DeGAUSS</a> is designed to be <a href="using_degauss.html">used</a> at the <a href="using_degauss.html#Command_Line">command line</a> by issuing <a href="using_degauss.html#DeGAUSS_Commands">DeGAUSS commands</a> one at a
time to read and write CSV files. Our <a href="sample_workflow.html">Sample Workflow</a> and other specific
step-by-step guides specify each command, including the input and output
filenames, but this approach can be inflexible and working with longer
and longer CSV file names can be cumbersome.</p>
<p><code><a href="../reference/degauss_run.html">degauss_run()</a></code> is a method for using DeGAUSS on a data
frame in R instead of on a CSV file on disk. Data is passed to DeGAUSS
via system Docker calls and the resulting data is read back into R.
Since DeGAUSS always works by <em>adding</em> additional columns to the
original input data, <code><a href="../reference/degauss_run.html">degauss_run()</a></code> can be used to flexibly
create DeGAUSS data pipelines from within R. This also allows for
cleaner integration of <code>Make</code>-like workflows for geomarker
assessment at scale.</p>
<p>An example DeGAUSS pipeline in R might look like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">addresses</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"postal"</span>, <span class="st">"0.1.4"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id</span>, address <span class="op">=</span> <span class="va">parsed_address</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"geocoder"</span>, <span class="st">"3.2.1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">lat</span>, <span class="va">lon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"census_block_group"</span>, <span class="st">"0.6.0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"greenspace"</span>, <span class="st">"0.3.0"</span><span class="op">)</span></span></code></pre></div>
<p>The next section is a detailed example with step-by-step code and
output.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://degauss.org/dht">dht</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="create-addresses">Create addresses<a class="anchor" aria-label="anchor" href="#create-addresses"></a>
</h4>
<p>Addresses could be imported from a CSV file, database, or other
source. For the sake of this example, we’ll use ten addresses randomly
sampled from <a href="http://cagis.org/Opendata/Auditor/" class="external-link">all dwellings
in Hamilton County, Ohio</a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">addresses</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"g_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    address <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"518 Fortune Ave Cincinnati OH 45219"</span>,</span>
<span>      <span class="st">"3201 Stanhope Av Apt. 2 Cincinnati, OH 45211"</span>,</span>
<span>      <span class="st">"3917 Catherine Av Norwood OH 45212"</span>,</span>
<span>      <span class="st">"9960 Carolina Trace Road Harrison Township OH 45030"</span>,</span>
<span>      <span class="st">"332 East Sharon Rd Unit #15 Glendale OH 45246"</span>,</span>
<span>      <span class="st">"10101 Hamilton Cleves Road Crosby Township OH 45030"</span>,</span>
<span>      <span class="st">"6076 Lagrange Ln Green Township, OH 45239"</span>,</span>
<span>      <span class="st">"1325 Fuhrman Rd Reading, OH 45215"</span>,</span>
<span>      <span class="st">"8831 Wellerstation Drive Montgomery OH 45249"</span>,</span>
<span>      <span class="st">"2916 Willow Ridge Dr Colerain Township OH 45251"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parse-addresses">Parse Addresses<a class="anchor" aria-label="anchor" href="#parse-addresses"></a>
</h4>
<p>Before geocoding, we will use the DeGAUSS <code>postal</code> image
to create a “normalized and parsed” address column. We keep only our
<code>id</code> column and the parsed addresses as <code>address</code>
so that we can use it in the next step for geocoding.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">addresses</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"postal"</span>, <span class="st">"0.1.4"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id</span>, address <span class="op">=</span> <span class="va">parsed_address</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="geocode-parsed-addresses">Geocode Parsed Addresses<a class="anchor" aria-label="anchor" href="#geocode-parsed-addresses"></a>
</h4>
<p>Geocode the addresses and keep only the <code>id</code>, latitude
(<code>lat</code>), and longitude (<code>lon</code>) columns, discarding
the addresses.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"geocoder"</span>, <span class="st">"3.2.1"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">lat</span>, <span class="va">lon</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-2020-census-tract-geographies">Add 2020 Census Tract Geographies<a class="anchor" aria-label="anchor" href="#add-2020-census-tract-geographies"></a>
</h4>
<p>Attach 2020 census tract and block group identifiers. Here, we
specify <code>argument = "2020"</code> to ensure the DeGAUSS image uses
the correct vintage of census geographies.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"census_block_group"</span>, <span class="st">"0.6.0"</span>, argument <span class="op">=</span> <span class="st">"2020"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="merge-census-data">Merge Census Data<a class="anchor" aria-label="anchor" href="#merge-census-data"></a>
</h4>
<p>Census tract identifiers can be used to link <a href="https://geomarker.io/hh_acs_measures" class="external-link">lots</a> and <a href="https://geomarker.io/census_mega_dataset" class="external-link">lots</a> of different
types of data. Download the 2018 <a href="https://geomarker.io/dep_index" class="external-link">material deprivation index</a> and
join it to our data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dep_index</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/geomarker-io/dep_index/raw/master/2018_dep_index/ACS_deprivation_index_by_census_tracts.rds"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/gzcon.html" class="external-link">gzcon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dep_index</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"census_tract_id_2020"</span> <span class="op">=</span> <span class="st">"census_tract_fips"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-greenness">Add Greenness<a class="anchor" aria-label="anchor" href="#add-greenness"></a>
</h4>
<p>As an example of geomarker assessment that does not rely on census
geography, we add the mean EVI (enhanced vegetation index) within three
differently sized buffers (radii of 500, 1,500, and 2,500 m) around each
location.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/degauss_run.html">degauss_run</a></span><span class="op">(</span><span class="st">"greenspace"</span>, <span class="st">"0.3.0"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Our geomarker assessment process is complete and everything is linked
in one data frame, ready for storing, analyzing, and sharing.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Erika Rasnick, Cole Brokamp.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
